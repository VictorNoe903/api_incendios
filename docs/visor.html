<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8">
  <title>Vista protegida | API Nacional</title>
  <style>
    body {
      background: #0b0b0b;
      color: #00ff88;
      font-family: monospace;
      user-select: none;
      overflow: hidden;
      margin: 0;
      padding: 20px;
    }

    #json {
      white-space: pre-wrap;
      background: #0e0e0e;
      border: 1px solid #00ff8855;
      box-shadow: 0 0 15px #00ff8833;
      border-radius: 10px;
      padding: 20px;
      height: 90vh;
      overflow-y: auto;
      font-size: 0.9rem;
    }

    #bloqueo {
      position: fixed;
      top: 0; left: 0;
      width: 100%; height: 100%;
      background: rgba(0,0,0,0.92);
      display: flex; flex-direction: column;
      justify-content: center; align-items: center;
      color: white; font-size: 1.5rem;
      z-index: 9999;
      backdrop-filter: blur(5px);
    }

    .parpadeo {
      animation: blink 1.5s infinite;
    }

    @keyframes blink {
      50% { opacity: 0.4; }
    }
  </style>
</head>

<body>
  <pre id="json">ðŸ”’ Cargando vista protegida...</pre>
  <div id="bloqueo" class="parpadeo">ðŸ”’ Acceso directo bloqueado. Use la API oficial.</div>

  <script>
    // Bloqueos de interacciÃ³n
    document.addEventListener('contextmenu', e => e.preventDefault());
    document.addEventListener('keydown', e => {
      if (
        (e.ctrlKey && ['s','u','c','a','p'].includes(e.key.toLowerCase())) ||
        e.key === 'PrintScreen' ||
        e.key === 'F12'
      ) e.preventDefault();
    });

    let datos = [];
    let indice = 0;
    let intervalo;

    // Detectar tipo desde el query ?view=
    function obtenerTipo() {
      const params = new URLSearchParams(window.location.search);
      return params.get('view') || 'teziutlan';
    }

    async function cargarDatos() {
      const visor = document.getElementById('json');
      visor.textContent = "ðŸ“¡ Conectando con el dataset...";
      try {
        const tipo = obtenerTipo();
        const resp = await fetch(`/data/${tipo}.json`);
        if (!resp.ok) throw new Error("Error al cargar JSON");
        datos = await resp.json();
        visor.textContent = `âœ… Dataset '${tipo}' cargado (${datos.length} registros)\n\nPreparando visualizaciÃ³n...`;
        indice = 0;
        iniciarCiclo();
      } catch (err) {
        visor.textContent = "âš ï¸ Error: No se pudieron cargar los datos.";
      }
    }

    function iniciarCiclo() {
      clearInterval(intervalo);
      const visor = document.getElementById('json');
      const tipo = obtenerTipo().toUpperCase();

      intervalo = setInterval(() => {
        if (!datos.length) return;
        const subset = datos.slice(indice, indice + 10);
        const texto = JSON.stringify(subset, null, 2);
        visor.textContent = `ðŸ”¹ Dataset: ${tipo}\nðŸ”¹ Mostrando registros ${indice + 1} - ${indice + subset.length} de ${datos.length}\n\n${texto}`;
        indice = (indice + 10) % datos.length;
      }, 2000);
    }

    window.onload = cargarDatos;
  </script>
</body>
</html>
